import speech_recognition as sr
from gtts import gTTS
import os
import pygame

pygame.mixer.init()


def listen_to_audio():
    recognizer = sr.Recognizer()
    with sr.Microphone() as source:
        print("Listening...")
        recognizer.adjust_for_ambient_noise(source)
        audio_data = recognizer.listen(source)

    try:
        print("Recognizing...")
        text = recognizer.recognize_google(audio_data)
        return text
    except sr.UnknownValueError:
        print("Sorry, I couldn't understand the audio.")
        return ""
    except sr.RequestError:
        print("Sorry, there was an error processing the request.")
        return ""


def text_to_audio(text):
    try:
        tts = gTTS(text=text, lang="en")
        tts.save("output.mp3")
        pygame.mixer.music.load("output.mp3")
        pygame.mixer.music.play()
        while pygame.mixer.music.get_busy():
            pygame.time.Clock().tick(10)
        
    except Exception as e:  # Catch general exceptions for saving/playback
        print(f"Error playing audio: {e}")
    finally:  # Always stop and quit mixer (optional)
        pygame.mixer.music.stop()
        pygame.mixer.quit()
        os.remove("output.mp3")


if __name__ == "__main__":
    # Listen to audio input and convert it to text
    input_text = listen_to_audio()
    print("You said:", input_text)

    # Convert the text back to audio and play it
    text_to_audio(input_text)
